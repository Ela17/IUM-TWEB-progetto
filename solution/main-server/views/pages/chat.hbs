{{!-- 
  Chat Lobby di CinemaHub
  Punto di accesso alle stanze di chat real-time per discussioni su film
--}}

<!-- Chat Header -->
<div class="chat-header bg-dark text-white py-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="display-5 fw-bold mb-2">
          <i class="bi bi-chat-dots me-3 text-cinema-gold"></i>
          Cinema Chat Lobby
        </h1>
        <p class="lead mb-0">Join or create chat rooms for movie discussions</p>
      </div>
      <div class="col-md-4 text-end">
        <div class="chat-stats d-flex gap-3 justify-content-end">
          <div class="text-center">
            <div class="fw-bold text-cinema-gold" id="online-users">{{#if onlineUsers}}{{onlineUsers}}{{else}}0{{/if}}</div>
            <small>Online</small>
          </div>
          <div class="text-center">
            <div class="fw-bold text-success" id="current-room-users">0</div>
            <small>In Room</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Chat Interface -->
<div class="container mt-4">
  <div class="row">
    
    <!-- Rooms Sidebar -->
    <div class="col-md-3 mb-4">
      <div class="card chat-sidebar h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h6 class="mb-0">
            <i class="bi bi-door-open me-2"></i>
            Chat Rooms
          </h6>
          <button class="btn btn-sm btn-cinema-gold" id="create-room-btn">
            <i class="bi bi-plus-circle"></i>
          </button>
        </div>
        <div class="card-body p-0">
          <!-- Active Rooms List -->
          <div id="rooms-list" class="rooms-list">
            <div class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-cinema-gold" role="status"></div>
              <p class="mt-2 mb-0 small">Loading rooms...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Main Area -->
    <div class="col-md-9">
      <div class="chat-container">
        
        <!-- Chat Welcome/Join Screen -->
        <div id="chat-welcome" class="card chat-welcome text-center">
          <div class="card-body py-5">
            <i class="bi bi-chat-heart text-cinema-gold mb-3" style="font-size: 4rem;"></i>
            <h3 class="mb-3">Welcome to Cinema Chat Lobby!</h3>
            <p class="text-muted mb-4">Join a room to start discussing movies, reviews, and cinema insights with fellow enthusiasts.</p>
            
            <div class="welcome-actions">
              <button class="btn btn-cinema-gold btn-lg me-2 hover-lift" id="quick-join-btn">
                <i class="bi bi-lightning me-2"></i>
                Quick Join
              </button>
              <button class="btn btn-outline-primary btn-lg hover-lift" id="browse-rooms-btn">
                <i class="bi bi-search me-2"></i>
                Browse Rooms
              </button>
            </div>
          </div>
        </div>

        <!-- Active Chat Interface -->
        <div id="chat-interface" class="chat-interface d-none">
          
          <!-- Chat Room Header -->
          <div class="card mb-3 chat-room-header">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="mb-1" id="current-room-name">General Discussion</h5>
                  <small class="text-muted" id="current-room-topic">Welcome to the general chat room</small>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-outline-secondary" id="room-info-btn" title="Room Info">
                    <i class="bi bi-info-circle"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" id="leave-room-btn" title="Leave Room">
                    <i class="bi bi-box-arrow-left"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Messages Container -->
          <div class="card chat-messages-card">
            <div class="card-body p-0">
              <div id="messages-container" class="messages-container">
                <!-- Messages will be populated here -->
              </div>
            </div>
          </div>

          <!-- Message Input -->
          <div class="card mt-3 message-input-card">
            <div class="card-body">
              <form id="message-form" class="d-flex align-items-center gap-2">
                <div class="flex-grow-1">
                  <input type="text" id="message-input" class="form-control" 
                          placeholder="Type your message..." maxlength="500" autocomplete="off">
                </div>
                <button type="submit" class="btn btn-cinema-gold hover-lift" id="send-btn">
                  <i class="bi bi-send"></i>
                </button>
              </form>
              <div class="d-flex justify-content-between mt-2">
                <small class="text-muted">
                  Connected as: <span id="current-username" class="fw-bold">Guest</span>
                </small>
                <small class="text-muted">
                  <span id="char-count">0</span>/500
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Connection Status -->
<div id="connection-status" class="connection-status d-none">
  <div class="alert alert-warning mb-0">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <span id="connection-message">Connecting to chat server...</span>
  </div>
</div>

<!-- Create Room Modal -->
<div class="modal fade" id="createRoomModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-plus-circle me-2 text-cinema-gold"></i>
          Create New Room
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="create-room-form">
        <div class="modal-body">
          <div class="mb-3">
            <label for="new-room-name" class="form-label">Room Name</label>
            <input type="text" class="form-control" id="new-room-name" required 
                    placeholder="Enter room name..." maxlength="50">
          </div>
          <div class="mb-3">
            <label for="new-room-topic" class="form-label">Topic (Optional)</label>
            <textarea class="form-control" id="new-room-topic" rows="3" 
                      placeholder="Describe what this room is about..." maxlength="200"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-cinema-gold">
            <i class="bi bi-plus-circle me-1"></i>
            Create Room
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Room Info Modal -->
<div class="modal fade" id="roomInfoModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-info-circle me-2 text-cinema-gold"></i>
          Room Information
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12 mb-3">
            <h6>Room Name:</h6>
            <p id="info-room-name" class="text-muted">-</p>
          </div>
          <div class="col-12 mb-3">
            <h6>Topic:</h6>
            <p id="info-room-topic" class="text-muted">-</p>
          </div>
          <div class="col-6 mb-3">
            <h6>Users Online:</h6>
            <p id="info-room-users" class="text-muted">-</p>
          </div>
          <div class="col-6 mb-3">
            <h6>Created:</h6>
            <p id="info-room-created" class="text-muted">-</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
